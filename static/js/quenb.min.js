var version="Webclient,0,0,10";var timeout=20000;$(document).ready(function(){var a=getClientFacts();try{process(a);}catch(b){$('.special').addClass('hidden');$('.special#tvstatic').removeClass('hidden');noty({type:'error',text:b,layout:'topCenter'});setTimeout(function(){location.reload(true);},timeout);}});function check_display(a){var b={};var c="/display?";for(key in a)c=c+'&'+key+'='+a[key];;$.ajax(c,{'async':false,'success':function(a){b=JSON.parse(a);},'error':function(){b={'error':"Failure to contact control server.",'special_show':'tvstatic'};}});return b;}function overrideFacts(a,b){if(typeof b!=='object'||b==null)return a;return $.extend(a,b);}function getClientFacts(){var a=window.location.search.substr(1).split('&');var b={"version":version,"last_query":window.location.href,"window_width":$(document).width(),"window_height":$(document).height(),"calls":0,"timeout":timeout};b=overrideFacts(b,a);return b;}function process(a){a.calls=a.calls+1;var b=check_display(a);if(b.error)var c=noty({type:'error',text:b.error,timeout:5000,layout:'topCenter'});if(b.info)var c=noty({type:'info',text:b.info,timeout:5000,layout:'topCenter'});if(b.restart_client){noty({type:'alert',text:"This webclient will reload shortly.",layout:'topCenter'});setTimeout(function(){location.reload(true);},5000);}$('.special').addClass('hidden');$('#imgfullscreen').addClass('hidden');if(b.special_show)$('.special#'+b.special_show).removeClass('hidden');else if(b.display_image&&!b.display_url){$('#imgfullscreen').attr('src',b.display_image);$('#imgfullscreen').removeClass('hidden');}var d=b.display_url;var e=b.force_refresh;var f=a.last_displayed;if(!$('iframe').length)$('body').append('<iframe>');if((d!==f)||e)$('iframe').attr('src',d);a.last_displayed=b.display_url;a.last_data=b;if(b.client_facts)a=overrideFacts(a,b.client_facts);setTimeout(function(){process(a);},a.timeout);}