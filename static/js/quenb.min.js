var version="Webclient,0,0,10";var timeout=30000;$(document).ready(function(){var a=getClientFacts();try{check_display(a);}catch(b){$('.special').addClass('hidden');$('.special#tvstatic').removeClass('hidden');notify('error',b);setTimeout(function(){location.reload(true);},timeout);}});function check_display(a){var b="/display?";for(key in a)b=b+'&'+key+'='+a[key];;$.ajax({'type':'get','url':b,'success':function(b){data=JSON.parse(b);process(a,data);},'error':function(){data={'error':"Failure to contact control server.",'special_show':'tvstatic'};process(a,data);},'complete':function(){foo='completed';}});}function overrideFacts(a,b){if(typeof b!=='object'||b==null)return a;return $.extend(a,b);}function getClientFacts(){var a=window.location.search.substr(1).split('&');var b={"version":version,"last_query":window.location.href,"window_width":$(document).width(),"window_height":$(document).height(),"calls":0,"timeout":timeout};b=overrideFacts(b,a);return b;}function process(a,b){a.calls=a.calls+1;if(b.error)notify('error',b.error);if(b.info)notify('info',b.info);if(b.restart_client){notify('alert','This webclient will reload shortly.');setTimeout(function(){location.reload(true);},5000);}$('.special').addClass('hidden');$('#imgfullscreen').addClass('hidden');if(b.special_show)$('.special#'+b.special_show).removeClass('hidden');else if(b.display_image&&!b.display_url){$('#imgfullscreen').attr('src',b.display_image);$('#imgfullscreen').removeClass('hidden');}var c=b.display_url;var d=b.force_refresh;var e=a.last_displayed;if(!$('iframe').length)$('body').append('<iframe>');if((c!==e)||d)$('iframe').attr('src',c);a.last_displayed=b.display_url;a.last_data=b;if(b.client_facts)a=overrideFacts(a,b.client_facts);setTimeout(function(){check_display(a);},a.timeout);}function notify(a,b){if(a=='error'){$('#notices').css('color','#B94A48');$('#notices').css('border-color','#EED3D7');$('#notices').css('background-color','#F2DEDE');}else if(a=='alert'){$('#notices').css('color','#468847');$('#notices').css('border-color','#D6E9C6');$('#notices').css('background-color','#DFF0D8');}else{$('#notices').css('color','#3A87AD');$('#notices').css('border-color','#BCE8F1');$('#notices').css('background-color','#D9EDF7');}$('#notices').html(b);$('#notices').removeClass('hidden');setTimeout(function(){$('#notices').html('');$('#notices').addClass('hidden');},4000);}